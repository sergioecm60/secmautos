<div class="card">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>üí∞ Gesti√≥n de Pagos</h3>
        <button class="btn btn-primary" onclick="abrirModalPago()">
            <i class="bi bi-plus-circle"></i> Nuevo Pago
        </button>
    </div>

    <!-- Pesta√±as de tipo de pago -->
    <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="pills-todos-tab" data-tipo="" onclick="filtrarPorTipo('')">
                üìã Todos
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="pills-patente-tab" data-tipo="patente" onclick="filtrarPorTipo('patente')">
                üèõÔ∏è Patentes
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="pills-seguro-tab" data-tipo="seguro" onclick="filtrarPorTipo('seguro')">
                üõ°Ô∏è Seguros
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="pills-vtv-tab" data-tipo="vtv" onclick="filtrarPorTipo('vtv')">
                üîç VTV
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="pills-multa-tab" data-tipo="multa" onclick="filtrarPorTipo('multa')">
                ‚ö†Ô∏è Multas
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="pills-servicios-tab" data-tipo="servicios" onclick="filtrarPorTipo('servicios')">
                üõ†Ô∏è Servicios
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="pills-otro-tab" data-tipo="otro" onclick="filtrarPorTipo('otro')">
                üì¶ Otros
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="pills-combustible-tab" data-tipo="combustible" onclick="filtrarPorTipo('combustible')">
                ‚õΩ Combustible
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="pills-telepase-tab" data-tipo="telepase" onclick="filtrarPorTipo('telepase')">
                üí≥ Telepase
            </button>
        </li>
    </ul>

    <!-- Filtros adicionales -->
    <div class="row g-2 mb-3">
        <div class="col-md-3">
            <input type="text" class="form-control" id="filtro-patente" placeholder="Buscar por patente" onchange="filtrarPagos()">
        </div>
        <div class="col-md-3">
            <select class="form-select" id="filtro-pagado" onchange="filtrarPagos()">
                <option value="">Todos los estados</option>
                <option value="0">Pendientes</option>
                <option value="1">Pagados</option>
            </select>
        </div>
        <div class="col-md-3">
            <input type="date" class="form-control" id="filtro-fecha-desde" placeholder="Desde" onchange="filtrarPagos()">
        </div>
        <div class="col-md-3">
            <input type="date" class="form-control" id="filtro-fecha-hasta" placeholder="Hasta" onchange="filtrarPagos()">
        </div>
    </div>

    <!-- Tabla de pagos -->
    <div class="table-responsive">
        <table class="table table-hover" id="tabla-pagos">
            <thead>
                <tr>
                    <th>Patente</th>
                    <th>Tipo</th>
                    <th>Detalle</th>
                    <th>Vencimiento</th>
                    <th>Monto</th>
                    <th>Estado</th>
                    <th>Fecha Pago</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<!-- Modal Formulario Pago -->
<div class="modal fade" id="modalPago" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalPagoTitle">Nuevo Pago</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="form-pago">
                    <input type="hidden" name="csrf_token" value="<?= $_SESSION['csrf_token'] ?>">
                    <input type="hidden" name="id" id="pago-id">

                    <!-- Veh√≠culo y Tipo (siempre visible) -->
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">Veh√≠culo *</label>
                            <select class="form-select" name="vehiculo_id" id="pago-vehiculo" required>
                                <option value="">Seleccionar veh√≠culo</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Tipo de Pago *</label>
                            <select class="form-select" name="tipo" id="pago-tipo" required onchange="toggleCamposPorTipo()">
                                <option value="">Seleccionar tipo</option>
                                <option value="patente">üèõÔ∏è Patente (Impuesto Automotor)</option>
                                <option value="seguro">üõ°Ô∏è Seguro</option>
                                <option value="vtv">üîç VTV (Verificaci√≥n T√©cnica)</option>
                                <option value="multa">‚ö†Ô∏è Multa</option>
                                <option value="servicios">üõ†Ô∏è Servicios</option>
                                <option value="combustible">‚õΩ Combustible</option>
                                <option value="telepase">üí≥ Telepase</option>
                                <option value="otro">üì¶ Otro</option>
                            </select>
                        </div>
                    </div>

                    <!-- Campos espec√≠ficos para PATENTE -->
                    <div id="campos-patente" class="campos-tipo" style="display: none;">
                        <hr class="my-3">
                        <h6 class="text-primary">üèõÔ∏è Datos de Patente (Impuesto Automotor)</h6>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Cuota</label>
                                <select class="form-select" name="cuota_patente">
                                    <option value="anual">Anual (√∫nica cuota)</option>
                                    <option value="1">1ra Cuota (Semestre 1)</option>
                                    <option value="2">2da Cuota (Semestre 2)</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Fecha Vencimiento *</label>
                                <input type="date" class="form-control" name="fecha_vencimiento_patente">
                            </div>
                        </div>
                    </div>

                    <!-- Campos espec√≠ficos para SEGURO -->
                    <div id="campos-seguro" class="campos-tipo" style="display: none;">
                        <hr class="my-3">
                        <h6 class="text-primary">üõ°Ô∏è Datos del Seguro</h6>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Aseguradora *</label>
                                <input type="text" class="form-control" name="aseguradora" placeholder="Ej: Pac√≠fico, Mapfre">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">N√∫mero de P√≥liza</label>
                                <input type="text" class="form-control" name="poliza_numero" placeholder="Ej: 12345678">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Fecha Inicio</label>
                                <input type="date" class="form-control" name="fecha_inicio">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Fecha Vencimiento *</label>
                                <input type="date" class="form-control" name="fecha_vencimiento_seguro">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Estado P√≥liza</label>
                                <select class="form-select" name="estado_poliza">
                                    <option value="vigente">Vigente</option>
                                    <option value="vencida">Vencida</option>
                                    <option value="cancelada">Cancelada</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Campos espec√≠ficos para VTV -->
                    <div id="campos-vtv" class="campos-tipo" style="display: none;">
                        <hr class="my-3">
                        <h6 class="text-primary">üîç Datos de VTV</h6>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Fecha de Inspecci√≥n *</label>
                                <input type="date" class="form-control" name="fecha_inspeccion_vtv">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Fecha Vencimiento *</label>
                                <input type="date" class="form-control" name="fecha_vencimiento_vtv">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Resultado VTV</label>
                                <select class="form-select" name="resultado_vtv">
                                    <option value="aprobada">‚úÖ Aprobada</option>
                                    <option value="condicional">‚ö†Ô∏è Condicional</option>
                                    <option value="rechazada">‚ùå Rechazada</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">N√∫mero Oblea/Certificado</label>
                                <input type="text" class="form-control" name="numero_oblea_vtv" placeholder="Ej: VTV-2024-12345">
                            </div>
                        </div>
                    </div>

                    <!-- Campos espec√≠ficos para MULTA -->
                    <div id="campos-multa" class="campos-tipo" style="display: none;">
                        <hr class="my-3">
                        <h6 class="text-primary">‚ö†Ô∏è Datos de Multa</h6>
                        <div class="row g-3">
                            <div class="col-12">
                                <label class="form-label">Multa Existente</label>
                                <select class="form-select" id="select-multa" name="multa_id">
                                    <option value="">Seleccionar multa pendiente...</option>
                                </select>
                                <small class="text-muted">O cree una nueva multa desde el m√≥dulo de Multas</small>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">N√∫mero de Acta</label>
                                <input type="text" class="form-control" name="numero_acta_multa" placeholder="Ej: 123456">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Fecha Vencimiento *</label>
                                <input type="date" class="form-control" name="fecha_vencimiento_multa">
                            </div>
                        </div>
                    </div>

                    <!-- Campos espec√≠ficos para COMBUSTIBLE -->
                    <div id="campos-combustible" class="campos-tipo" style="display: none;">
                        <hr class="my-3">
                        <h6 class="text-primary">‚õΩ Datos de Combustible</h6>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Estaci√≥n</label>
                                <input type="text" class="form-control" name="estacion_combustible" placeholder="Ej: YPF, Shell, Axion">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">N√∫mero de Comprobante</label>
                                <input type="text" class="form-control" name="comprobante_combustible" placeholder="Ej: A-001234">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Tipo de Combustible</label>
                                <select class="form-select" name="tipo_combustible">
                                    <option value="Nafta">Nafta</option>
                                    <option value="Nafta Super">Nafta Super</option>
                                    <option value="Nafta Premium">Nafta Premium</option>
                                    <option value="Diesel">Diesel</option>
                                    <option value="Diesel Premium">Diesel Premium</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Litros</label>
                                <input type="number" step="0.01" class="form-control" name="litros_combustible" placeholder="0.00">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Precio por Litro ($)</label>
                                <input type="number" step="0.01" class="form-control" name="precio_litro_combustible" placeholder="0.00">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Od√≥metro (km)</label>
                                <input type="number" class="form-control" name="odometro_combustible" placeholder="0">
                            </div>
                        </div>
                    </div>

                    <!-- Campos espec√≠ficos PARA TELEPASE -->
                    <div id="campos-telepase" class="campos-tipo" style="display: none;">
                        <hr class="my-3">
                        <h6 class="text-primary">üí≥ Datos de Telepase</h6>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">N√∫mero de Dispositivo</label>
                                <select class="form-select" name="dispositivo_telepase" id="select-telepase">
                                    <option value="">Seleccionar dispositivo...</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Concesionario</label>
                                <input type="text" class="form-control" name="concesionario_telepase" placeholder="Ej: AUSA, Autopista Central">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Periodo</label>
                                <input type="month" class="form-control" name="periodo_telepase">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">N√∫mero de Comprobante</label>
                                <input type="text" class="form-control" name="comprobante_telepase" placeholder="Ej: REC-001-2025">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Fecha Vencimiento *</label>
                                <input type="date" class="form-control" name="fecha_vencimiento_telepase">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Fecha Vencimiento Recargo</label>
                                <input type="date" class="form-control" name="fecha_recargo_telepase">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Estado</label>
                                <select class="form-select" name="estado_telepase">
                                    <option value="pendiente">Pendiente</option>
                                    <option value="pagado">Pagado</option>
                                    <option value="vencido">Vencido</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Campos espec√≠ficos para SERVICIOS y OTRO -->
                    <div id="campos-general" class="campos-tipo" style="display: none;">
                        <hr class="my-3">
                        <div class="row g-3">
                            <div class="col-12">
                                <label class="form-label">Descripci√≥n del Servicio/Pago</label>
                                <input type="text" class="form-control" name="descripcion_servicio" placeholder="Ej: Lavado, Estacionamiento, etc.">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Fecha Vencimiento *</label>
                                <input type="date" class="form-control" name="fecha_vencimiento_general">
                            </div>
                        </div>
                    </div>

                    <!-- Campos comunes a todos -->
                    <hr class="my-3">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">Monto ($) *</label>
                            <input type="number" step="0.01" class="form-control" name="monto" id="pago-monto" required placeholder="0.00">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">N¬∫ Comprobante</label>
                            <input type="text" class="form-control" name="comprobante" id="pago-comprobante" placeholder="Ej: A-001234">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">¬øYa est√° pagado?</label>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="pago-pagado" name="pagado" onchange="toggleFechaPago()">
                                <label class="form-check-label" for="pago-pagado">Marcar como pagado</label>
                            </div>
                        </div>
                        <div class="col-md-6" id="campo-fecha-pago" style="display: none;">
                            <label class="form-label">Fecha de Pago</label>
                            <input type="date" class="form-control" name="fecha_pago" id="pago-fecha-pago">
                        </div>
                        <div class="col-12">
                            <label class="form-label">Observaciones</label>
                            <textarea class="form-control" name="observaciones" id="pago-observaciones" rows="2" placeholder="Observaciones adicionales..."></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" onclick="guardarPago()">Guardar Pago</button>
            </div>
        </div>
    </div>
</div>

<style>
.nav-pills .nav-link {
    border-radius: 20px;
    margin-right: 5px;
    font-size: 0.9rem;
}

.nav-pills .nav-link.active {
    background-color: var(--bs-primary);
}

.campos-tipo {
    background-color: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
    margin-top: 15px;
}

.dark-theme .campos-tipo {
    background-color: #2b2b2b;
}
</style>
